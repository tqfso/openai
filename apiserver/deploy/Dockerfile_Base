FROM ubuntu:22.04

# 设置非交互模式
ENV DEBIAN_FRONTEND=noninteractive

# 第一步：先用官方 HTTP 源安装 ca-certificates（必须！）
RUN apt-get update && \
    apt-get install -y --no-install-recommends ca-certificates && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# 第二步：现在有了证书，安全替换为阿里云 HTTPS 源
RUN echo "deb https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse\n\
deb https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse\n\
deb https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse\n\
deb https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse" \
    > /etc/apt/sources.list

# 第三步：用阿里云源安装 Python
RUN apt-get update && \
    apt-get install -y --no-install-recommends python3 python3-pip && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# 验证
RUN python3 --version && pip3 --version